
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../nmap_scanner/">
      
      
        <link rel="next" href="../zap_scanner/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Nikto Scanner - VulnScanAI Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nikto-scanner" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="VulnScanAI Documentation" class="md-header__button md-logo" aria-label="VulnScanAI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            VulnScanAI Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nikto Scanner
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="VulnScanAI Documentation" class="md-nav__button md-logo" aria-label="VulnScanAI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    VulnScanAI Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../toc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Table of Contents
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    App Directory
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            App Directory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Scanners Directory
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Scanners Directory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scanners/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nmap_scanner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nmap Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Nikto Scanner
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Nikto Scanner
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-get_nikto_report_base_directory" class="md-nav__link">
    <span class="md-ellipsis">
      1. get_nikto_report_base_directory()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-get_nikto_results_directory" class="md-nav__link">
    <span class="md-ellipsis">
      2. get_nikto_results_directory()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-get_authenticated_nikto_results_directory" class="md-nav__link">
    <span class="md-ellipsis">
      3. get_authenticated_nikto_results_directory()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-remove_nikto_summaryhtml_content" class="md-nav__link">
    <span class="md-ellipsis">
      4. remove_nikto_summary(html_content)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-convert_html_to_pdfhtml_content-pdf_path-logo_path-report_typenikto-scan-report" class="md-nav__link">
    <span class="md-ellipsis">
      5. convert_html_to_pdf(html_content, pdf_path, logo_path, report_type="Nikto Scan Report")
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-run_nikto_scantarget_url-user_idnone" class="md-nav__link">
    <span class="md-ellipsis">
      6. run_nikto_scan(target_url, user_id=None)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-run_nikto_authenticated_scantarget_url-username-password-user_idnone" class="md-nav__link">
    <span class="md-ellipsis">
      7. run_nikto_authenticated_scan(target_url, username, password, user_id=None)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Dependencies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Security Considerations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zap_scanner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ZAP Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mobsf_scanner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MobSF Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sqlmap_scanner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SQLMap Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssl_scanner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SSL Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prowler_scanner_aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prowler AWS Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prowler_scanner_gcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prowler GCP Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloudsploit_scanner_azure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CloudSploit Azure Scanner
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Views Directory
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Views Directory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-get_nikto_report_base_directory" class="md-nav__link">
    <span class="md-ellipsis">
      1. get_nikto_report_base_directory()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-get_nikto_results_directory" class="md-nav__link">
    <span class="md-ellipsis">
      2. get_nikto_results_directory()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-get_authenticated_nikto_results_directory" class="md-nav__link">
    <span class="md-ellipsis">
      3. get_authenticated_nikto_results_directory()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-remove_nikto_summaryhtml_content" class="md-nav__link">
    <span class="md-ellipsis">
      4. remove_nikto_summary(html_content)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-convert_html_to_pdfhtml_content-pdf_path-logo_path-report_typenikto-scan-report" class="md-nav__link">
    <span class="md-ellipsis">
      5. convert_html_to_pdf(html_content, pdf_path, logo_path, report_type="Nikto Scan Report")
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-run_nikto_scantarget_url-user_idnone" class="md-nav__link">
    <span class="md-ellipsis">
      6. run_nikto_scan(target_url, user_id=None)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-run_nikto_authenticated_scantarget_url-username-password-user_idnone" class="md-nav__link">
    <span class="md-ellipsis">
      7. run_nikto_authenticated_scan(target_url, username, password, user_id=None)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Dependencies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Security Considerations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset"><a class="md-content__button md-icon" download href="../pdf/combined.pdf" title="PDF Export"><svg style="height: 1.2rem; width: 1.2rem;" viewBox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm76.45 211.36l-96.42 95.7c-6.65 6.61-17.39 6.61-24.04 0l-96.42-95.7C73.42 337.29 80.54 320 94.82 320H160v-80c0-8.84 7.16-16 16-16h32c8.84 0 16 7.16 16 16v80h65.18c14.28 0 21.4 17.29 11.27 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"></path></svg></a>
                
                  



<h1 id="nikto-scanner">Nikto Scanner</h1>
<p>This document details the functionality of the <code>nikto_scanner.py</code> script, which automates web vulnerability scanning using Nikto. The script provides functions to execute both unauthenticated and authenticated Nikto scans, process the generated HTML reports, convert them to PDF format, and include a company logo within the reports.</p>
<h2 id="overview">Overview</h2>
<p>The script performs the following steps:</p>
<ol>
<li><strong>Defines Report Directories:</strong> Establishes directories for storing both unauthenticated and authenticated Nikto reports.</li>
<li><strong>Executes Nikto Scans:</strong> Runs Nikto scans against specified target URLs, with options for providing authentication credentials.</li>
<li><strong>Processes HTML Report:</strong> Removes the "Scan Summary" section from the generated HTML report for cleaner output.</li>
<li><strong>Converts to PDF:</strong> Converts the processed HTML report to a PDF format, adding a company logo and title page using <code>pdfkit</code> and <code>PyMuPDF</code>.</li>
<li><strong>Returns Report Filename:</strong> Returns the filename of the generated PDF report.</li>
</ol>
<h2 id="functions">Functions</h2>
<h3 id="1-get_nikto_report_base_directory">1. <code>get_nikto_report_base_directory()</code></h3>
<ul>
<li>
<p><strong>Purpose:</strong> Determines and creates the base directory where all Nikto reports will be stored.</p>
</li>
<li>
<p><strong>Functionality:</strong></p>
<ul>
<li>Defines the base directory path as <code>reports/nikto</code> within the Flask application's root directory.</li>
<li>Uses <code>os.makedirs(report_dir_base, exist_ok=True)</code> to create the directory if it doesn't exist. <code>exist_ok=True</code> prevents errors if the directory already exists.</li>
</ul>
</li>
<li>
<p><strong>Code Snippet:</strong></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-0-2"><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_app</span>
</span><span id="__span-0-3">
</span><span id="__span-0-4"><span class="k">def</span><span class="w"> </span><span class="nf">get_nikto_report_base_directory</span><span class="p">():</span>
</span><span id="__span-0-5">    <span class="n">report_dir_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_app</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="s1">&#39;reports&#39;</span><span class="p">,</span> <span class="s1">&#39;nikto&#39;</span><span class="p">)</span>
</span><span id="__span-0-6">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">report_dir_base</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-7">    <span class="k">return</span> <span class="n">report_dir_base</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="2-get_nikto_results_directory">2. <code>get_nikto_results_directory()</code></h3>
<ul>
<li>
<p><strong>Purpose:</strong> Determines and creates the directory for storing unauthenticated Nikto scan results.</p>
</li>
<li>
<p><strong>Functionality:</strong></p>
<ul>
<li>Creates a sub-directory named <code>nikto_results</code> within the base Nikto report directory.</li>
<li>Uses <code>os.makedirs()</code> to ensure the directory exists.</li>
</ul>
</li>
<li>
<p><strong>Code Snippet:</strong></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-1-2"><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_app</span>
</span><span id="__span-1-3">
</span><span id="__span-1-4"><span class="k">def</span><span class="w"> </span><span class="nf">get_nikto_results_directory</span><span class="p">():</span>
</span><span id="__span-1-5">    <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_nikto_report_base_directory</span><span class="p">(),</span> <span class="s1">&#39;nikto_results&#39;</span><span class="p">)</span>
</span><span id="__span-1-6">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-1-7">    <span class="k">return</span> <span class="n">results_dir</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="3-get_authenticated_nikto_results_directory">3. <code>get_authenticated_nikto_results_directory()</code></h3>
<ul>
<li>
<p><strong>Purpose:</strong> Determines and creates the directory for storing authenticated Nikto scan results.</p>
</li>
<li>
<p><strong>Functionality:</strong></p>
<ul>
<li>Creates a sub-directory named <code>authenticated_nikto_results</code> within the base Nikto report directory.</li>
<li>Uses <code>os.makedirs()</code> to ensure the directory exists.</li>
</ul>
</li>
<li>
<p><strong>Code Snippet:</strong></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-2-2"><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_app</span>
</span><span id="__span-2-3">
</span><span id="__span-2-4"><span class="k">def</span><span class="w"> </span><span class="nf">get_authenticated_nikto_results_directory</span><span class="p">():</span>
</span><span id="__span-2-5">    <span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_nikto_report_base_directory</span><span class="p">(),</span> <span class="s1">&#39;authenticated_nikto_results&#39;</span><span class="p">)</span>
</span><span id="__span-2-6">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-2-7">    <span class="k">return</span> <span class="n">results_dir</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="4-remove_nikto_summaryhtml_content">4. <code>remove_nikto_summary(html_content)</code></h3>
<ul>
<li>
<p><strong>Purpose:</strong> Removes the "Scan Summary" section from the Nikto HTML report.</p>
</li>
<li>
<p><strong>Functionality:</strong></p>
<ul>
<li>Parses the HTML content using <code>BeautifulSoup</code>.</li>
<li>Finds the <code>table</code> elements with the class <code>headerTable</code> that contains the text "Scan Summary" in its <code>td</code> element.</li>
<li>Finds the <code>table</code> element with the class <code>dataTable</code> that contains the summary data and that succeeds the header table.</li>
<li>Removes both the "Scan Summary" header table and the corresponding data table from the HTML.</li>
<li>Returns the modified HTML content as a string.</li>
</ul>
</li>
<li>
<p><strong>Code Snippet:</strong></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span><span id="__span-3-2">
</span><span id="__span-3-3"><span class="k">def</span><span class="w"> </span><span class="nf">remove_nikto_summary</span><span class="p">(</span><span class="n">html_content</span><span class="p">):</span>
</span><span id="__span-3-4"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes the Nikto scan summary section from the HTML.&quot;&quot;&quot;</span>
</span><span id="__span-3-5">    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
</span><span id="__span-3-6">
</span><span id="__span-3-7">    <span class="c1"># Find all tables with class &#39;headerTable&#39;</span>
</span><span id="__span-3-8">    <span class="n">header_tables</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;headerTable&#39;</span><span class="p">})</span>
</span><span id="__span-3-9">
</span><span id="__span-3-10">    <span class="c1"># Iterate on them until we find the match for the scan Summary, then break from loop</span>
</span><span id="__span-3-11">    <span class="n">scan_summary_header_table</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-3-12">    <span class="k">for</span> <span class="n">header_table</span> <span class="ow">in</span> <span class="n">header_tables</span><span class="p">:</span>
</span><span id="__span-3-13">        <span class="n">header_text</span> <span class="o">=</span> <span class="n">header_table</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)</span>  <span class="c1"># Find the &lt;td&gt; element</span>
</span><span id="__span-3-14">        <span class="k">if</span> <span class="n">header_text</span> <span class="ow">and</span> <span class="n">header_text</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Scan Summary&quot;</span><span class="p">:</span>
</span><span id="__span-3-15">            <span class="n">scan_summary_header_table</span> <span class="o">=</span> <span class="n">header_table</span>  <span class="c1"># Assign the match!</span>
</span><span id="__span-3-16">            <span class="k">break</span>  <span class="c1"># stop here, don&#39;t continue to iterate over the tables</span>
</span><span id="__span-3-17">
</span><span id="__span-3-18">    <span class="k">if</span> <span class="n">scan_summary_header_table</span><span class="p">:</span>
</span><span id="__span-3-19">        <span class="c1"># Find the data table that succeeds it</span>
</span><span id="__span-3-20">        <span class="n">scan_summary_data_table</span> <span class="o">=</span> <span class="n">scan_summary_header_table</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;dataTable&#39;</span><span class="p">})</span>
</span><span id="__span-3-21">
</span><span id="__span-3-22">        <span class="c1"># Remove the Tag</span>
</span><span id="__span-3-23">        <span class="n">scan_summary_header_table</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>  <span class="c1"># remove header table</span>
</span><span id="__span-3-24">
</span><span id="__span-3-25">        <span class="k">if</span> <span class="n">scan_summary_data_table</span><span class="p">:</span>  <span class="c1"># check data table to see if anything inside before removign the table</span>
</span><span id="__span-3-26">            <span class="n">scan_summary_data_table</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>  <span class="c1"># Remove the summary table</span>
</span><span id="__span-3-27">
</span><span id="__span-3-28">    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>  <span class="c1"># Return the modified HTML as a string</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="5-convert_html_to_pdfhtml_content-pdf_path-logo_path-report_typenikto-scan-report">5. <code>convert_html_to_pdf(html_content, pdf_path, logo_path, report_type="Nikto Scan Report")</code></h3>
<ul>
<li>
<p><strong>Purpose:</strong> Converts HTML content to PDF, adds a company logo and title using <code>pdfkit</code> for the initial conversion and <code>PyMuPDF</code> for post-processing.</p>
</li>
<li>
<p><strong>Functionality:</strong></p>
<ul>
<li><strong>HTML to PDF Conversion (pdfkit):</strong><ul>
<li>Uses <code>pdfkit.from_string()</code> to convert the HTML content to a PDF file at <code>pdf_path</code>.</li>
<li>Configures <code>pdfkit</code> with <code>wkhtmltopdf</code> executable path (obtained from <code>current_app.config</code> or defaults to <code>/usr/local/bin/wkhtmltopdf</code>).</li>
<li>Sets PDF options like page size, margins, and encoding.</li>
</ul>
</li>
<li><strong>Post-Processing (PyMuPDF):</strong><ul>
<li>Opens the generated PDF using <code>fitz.open()</code>.</li>
<li>Loads the company logo from <code>logo_path</code> using <code>fitz.Pixmap()</code>. The <code>logo_path</code> is joined with <code>current_app.root_path</code> to create an absolute path.</li>
<li>If the logo file exists, it calculates the logo's dimensions and position to center it on the first and last page.</li>
<li>Adds a new blank page at the beginning and the end of the PDF.</li>
<li>Inserts the logo and the report title onto the added first and last page.</li>
<li>Saves the modified PDF with incremental updates (<code>pdf_doc.saveIncr()</code>). This preserves the original PDF content while adding the new elements.</li>
</ul>
</li>
<li><strong>Error Handling:</strong> Uses <code>try...except</code> blocks to catch exceptions related to both <code>pdfkit</code> and <code>PyMuPDF</code> processes, ensuring proper error handling and reporting.</li>
</ul>
</li>
<li>
<p><strong>Code Snippet:</strong></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><span class="kn">import</span><span class="w"> </span><span class="nn">fitz</span>
</span><span id="__span-4-2"><span class="kn">import</span><span class="w"> </span><span class="nn">pdfkit</span>
</span><span id="__span-4-3"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-4-4"><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_app</span>
</span><span id="__span-4-5">
</span><span id="__span-4-6"><span class="k">def</span><span class="w"> </span><span class="nf">convert_html_to_pdf</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">logo_path</span><span class="p">,</span> <span class="n">report_type</span><span class="o">=</span><span class="s2">&quot;Nikto Scan Report&quot;</span><span class="p">):</span>  <span class="c1"># Added report_type argument</span>
</span><span id="__span-4-7"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert HTML content to PDF using pdfkit, then add logo with PyMuPDF.&quot;&quot;&quot;</span>
</span><span id="__span-4-8">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-4-9">        <span class="n">config</span> <span class="o">=</span> <span class="n">pdfkit</span><span class="o">.</span><span class="n">configuration</span><span class="p">(</span><span class="n">wkhtmltopdf</span><span class="o">=</span><span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WKHTMLTOPDF_EXECUTABLE&#39;</span><span class="p">,</span>
</span><span id="__span-4-10">                                                                           <span class="s1">&#39;/usr/local/bin/wkhtmltopdf&#39;</span><span class="p">))</span>  <span class="c1"># Get WKHTMLTOPDF path from config</span>
</span><span id="__span-4-11">        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-12">            <span class="s1">&#39;page-size&#39;</span><span class="p">:</span> <span class="s1">&#39;A4&#39;</span><span class="p">,</span>
</span><span id="__span-4-13">            <span class="s1">&#39;margin-top&#39;</span><span class="p">:</span> <span class="s1">&#39;10mm&#39;</span><span class="p">,</span>
</span><span id="__span-4-14">            <span class="s1">&#39;margin-right&#39;</span><span class="p">:</span> <span class="s1">&#39;10mm&#39;</span><span class="p">,</span>
</span><span id="__span-4-15">            <span class="s1">&#39;margin-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;10mm&#39;</span><span class="p">,</span>
</span><span id="__span-4-16">            <span class="s1">&#39;margin-left&#39;</span><span class="p">:</span> <span class="s1">&#39;10mm&#39;</span><span class="p">,</span>
</span><span id="__span-4-17">            <span class="s1">&#39;encoding&#39;</span><span class="p">:</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">,</span>  <span class="c1"># Crucial for special characters!</span>
</span><span id="__span-4-18">        <span class="p">}</span>
</span><span id="__span-4-19">        <span class="n">pdfkit</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">configuration</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span><span id="__span-4-20">                           <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># Convert from string</span>
</span><span id="__span-4-21">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully created PDF: </span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-22">
</span><span id="__span-4-23">        <span class="c1"># Add logo using PyMuPDF</span>
</span><span id="__span-4-24">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-4-25">            <span class="n">pdf_doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="__span-4-26">            <span class="n">logo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_app</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="n">logo_path</span><span class="p">)</span>  <span class="c1"># Absolute Path from Relative Path</span>
</span><span id="__span-4-27">            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">logo_path</span><span class="p">):</span>
</span><span id="__span-4-28">                <span class="n">logo</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Pixmap</span><span class="p">(</span><span class="n">logo_path</span><span class="p">)</span>
</span><span id="__span-4-29">                <span class="n">logo_width_pt</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># Adjust as needed</span>
</span><span id="__span-4-30">                <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">logo</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">logo</span><span class="o">.</span><span class="n">height</span>
</span><span id="__span-4-31">                <span class="n">logo_height_pt</span> <span class="o">=</span> <span class="n">logo_width_pt</span> <span class="o">/</span> <span class="n">aspect_ratio</span>
</span><span id="__span-4-32">
</span><span id="__span-4-33">                <span class="c1"># Create a new page as the first page</span>
</span><span id="__span-4-34">                <span class="n">new_page</span> <span class="o">=</span> <span class="n">pdf_doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">pdf_doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">pdf_doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
</span><span id="__span-4-35">                                             <span class="n">pno</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Insert as the *first* page</span>
</span><span id="__span-4-36">                <span class="n">page_width</span> <span class="o">=</span> <span class="n">new_page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span>
</span><span id="__span-4-37">                <span class="n">page_height</span> <span class="o">=</span> <span class="n">new_page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span>
</span><span id="__span-4-38">
</span><span id="__span-4-39">                <span class="c1"># Calculate total height of logo and title with gap</span>
</span><span id="__span-4-40">                <span class="n">title_text</span> <span class="o">=</span> <span class="n">report_type</span>  <span class="c1"># Use the dynamic report type</span>
</span><span id="__span-4-41">                <span class="n">font_size</span> <span class="o">=</span> <span class="mi">24</span>
</span><span id="__span-4-42">                <span class="n">text_height</span> <span class="o">=</span> <span class="n">font_size</span>  <span class="c1"># Approximate text height</span>
</span><span id="__span-4-43">
</span><span id="__span-4-44">                <span class="n">total_height</span> <span class="o">=</span> <span class="n">logo_height_pt</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">text_height</span>  <span class="c1"># Logo + gap + title</span>
</span><span id="__span-4-45">
</span><span id="__span-4-46">                <span class="c1"># Calculate starting Y position for vertical centering</span>
</span><span id="__span-4-47">                <span class="n">start_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">page_height</span> <span class="o">-</span> <span class="n">total_height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-4-48">
</span><span id="__span-4-49">                <span class="c1"># Calculate logo position (centered horizontally, vertically aligned)</span>
</span><span id="__span-4-50">                <span class="n">logo_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">page_width</span> <span class="o">-</span> <span class="n">logo_width_pt</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-4-51">                <span class="n">logo_y</span> <span class="o">=</span> <span class="n">start_y</span>  <span class="c1"># Distance from the top</span>
</span><span id="__span-4-52">
</span><span id="__span-4-53">                <span class="n">logo_rect</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">logo_x</span><span class="p">,</span> <span class="n">logo_y</span><span class="p">,</span> <span class="n">logo_x</span> <span class="o">+</span> <span class="n">logo_width_pt</span><span class="p">,</span> <span class="n">logo_y</span> <span class="o">+</span> <span class="n">logo_height_pt</span><span class="p">)</span>
</span><span id="__span-4-54">                <span class="n">new_page</span><span class="o">.</span><span class="n">insert_image</span><span class="p">(</span><span class="n">logo_rect</span><span class="p">,</span> <span class="n">pixmap</span><span class="o">=</span><span class="n">logo</span><span class="p">)</span>
</span><span id="__span-4-55">
</span><span id="__span-4-56">                <span class="c1"># Add a title (optional)</span>
</span><span id="__span-4-57">
</span><span id="__span-4-58">                <span class="n">text_width</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">get_text_length</span><span class="p">(</span><span class="n">title_text</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s2">&quot;helvetica-bold&quot;</span><span class="p">,</span>
</span><span id="__span-4-59">                                                   <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>  <span class="c1"># Use the get_text_length for exact positioning</span>
</span><span id="__span-4-60">                <span class="n">text_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">page_width</span> <span class="o">-</span> <span class="n">text_width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-4-61">                <span class="n">text_y</span> <span class="o">=</span> <span class="n">logo_y</span> <span class="o">+</span> <span class="n">logo_height_pt</span> <span class="o">+</span> <span class="mi">30</span>  <span class="c1"># Below the logo</span>
</span><span id="__span-4-62">                <span class="n">new_page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="n">text_x</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span> <span class="n">title_text</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s2">&quot;helvetica-bold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span>
</span><span id="__span-4-63">                                      <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Black text</span>
</span><span id="__span-4-64">
</span><span id="__span-4-65">                <span class="c1"># Add the same page to the end of the document</span>
</span><span id="__span-4-66">                <span class="n">last_page</span> <span class="o">=</span> <span class="n">pdf_doc</span><span class="o">.</span><span class="n">new_page</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">pdf_doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">pdf_doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>  <span class="c1"># Create new page with the same height and width with original file</span>
</span><span id="__span-4-67">                <span class="n">logo_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">page_width</span> <span class="o">-</span> <span class="n">logo_width_pt</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-4-68">                <span class="n">logo_y</span> <span class="o">=</span> <span class="n">start_y</span>  <span class="c1"># Distance from the top</span>
</span><span id="__span-4-69">
</span><span id="__span-4-70">                <span class="n">logo_rect</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">logo_x</span><span class="p">,</span> <span class="n">logo_y</span><span class="p">,</span> <span class="n">logo_x</span> <span class="o">+</span> <span class="n">logo_width_pt</span><span class="p">,</span> <span class="n">logo_y</span> <span class="o">+</span> <span class="n">logo_height_pt</span><span class="p">)</span>
</span><span id="__span-4-71">                <span class="n">last_page</span><span class="o">.</span><span class="n">insert_image</span><span class="p">(</span><span class="n">logo_rect</span><span class="p">,</span> <span class="n">pixmap</span><span class="o">=</span><span class="n">logo</span><span class="p">)</span>  <span class="c1"># insert the logo to the last page</span>
</span><span id="__span-4-72">
</span><span id="__span-4-73">                <span class="n">text_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">page_width</span> <span class="o">-</span> <span class="n">text_width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="__span-4-74">                <span class="n">text_y</span> <span class="o">=</span> <span class="n">logo_y</span> <span class="o">+</span> <span class="n">logo_height_pt</span> <span class="o">+</span> <span class="mi">30</span>  <span class="c1"># Below the logo</span>
</span><span id="__span-4-75">                <span class="n">last_page</span><span class="o">.</span><span class="n">insert_text</span><span class="p">((</span><span class="n">text_x</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span> <span class="n">title_text</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s2">&quot;helvetica-bold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span>
</span><span id="__span-4-76">                                      <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Black text #insert the text to the last page</span>
</span><span id="__span-4-77">
</span><span id="__span-4-78">                <span class="n">pdf_doc</span><span class="o">.</span><span class="n">saveIncr</span><span class="p">()</span>
</span><span id="__span-4-79">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully added new page and logo to PDF: </span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-80">            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-4-81">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Logo not found at </span><span class="si">{</span><span class="n">logo_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-82">
</span><span id="__span-4-83">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-4-84">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding new page and logo to PDF: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-85">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-4-86">
</span><span id="__span-4-87">        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="__span-4-88">
</span><span id="__span-4-89">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-4-90">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error converting HTML to PDF: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-91">        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="6-run_nikto_scantarget_url-user_idnone">6. <code>run_nikto_scan(target_url, user_id=None)</code></h3>
<ul>
<li>
<p><strong>Purpose:</strong> Executes an unauthenticated Nikto scan against a specified target URL.</p>
</li>
<li>
<p><strong>Functionality:</strong></p>
<ul>
<li>Defines the path to the Nikto executable.</li>
<li>Constructs the Nikto command with the target URL and output options.</li>
<li>Executes the Nikto command using <code>subprocess.Popen</code>.</li>
<li>Captures the standard output and standard error streams.</li>
<li>If the scan is successful (HTML report is generated), it reads the HTML content, removes the Nikto summary, and converts the modified HTML to a PDF report using <code>convert_html_to_pdf()</code>.</li>
<li>If PDF conversion is successful, the original HTML file is removed.</li>
<li>Returns the filename of the generated PDF report, or an error message if the scan or conversion fails.</li>
</ul>
</li>
<li>
<p><strong>Code Snippet:</strong></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-5-2"><span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
</span><span id="__span-5-3"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="__span-5-4"><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_app</span>
</span><span id="__span-5-5"><span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>  <span class="c1"># Import BeautifulSoup</span>
</span><span id="__span-5-6"><span class="kn">import</span><span class="w"> </span><span class="nn">pdfkit</span>
</span><span id="__span-5-7"><span class="kn">import</span><span class="w"> </span><span class="nn">fitz</span>
</span><span id="__span-5-8">
</span><span id="__span-5-9"><span class="k">def</span><span class="w"> </span><span class="nf">run_nikto_scan</span><span class="p">(</span><span class="n">target_url</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-5-10">    <span class="n">NIKTO_EXECUTABLE</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NIKTO_EXECUTABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;/usr/bin/nikto&#39;</span><span class="p">)</span>  <span class="c1"># Adjust path as needed</span>
</span><span id="__span-5-11">    <span class="n">COMPANY_LOGO_PATH</span> <span class="o">=</span> <span class="s1">&#39;static/images/company_logo.PNG&#39;</span>  <span class="c1"># Change to your actual logo path - RELATIVE URL</span>
</span><span id="__span-5-12">    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
</span><span id="__span-5-13">    <span class="n">results_dir</span> <span class="o">=</span> <span class="n">get_nikto_results_directory</span><span class="p">()</span>
</span><span id="__span-5-14">    <span class="n">html_report_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_nikto_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
</span><span id="__span-5-15">    <span class="n">pdf_report_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_nikto_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
</span><span id="__span-5-16">
</span><span id="__span-5-17">    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-5-18">        <span class="n">NIKTO_EXECUTABLE</span><span class="p">,</span>
</span><span id="__span-5-19">        <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="n">target_url</span><span class="p">,</span>
</span><span id="__span-5-20">        <span class="s1">&#39;-output&#39;</span><span class="p">,</span> <span class="n">html_report_filename</span><span class="p">,</span>
</span><span id="__span-5-21">        <span class="s1">&#39;-Format&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span>
</span><span id="__span-5-22">        <span class="s1">&#39;-timeout&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span>
</span><span id="__span-5-23">        <span class="s1">&#39;-maxtime&#39;</span><span class="p">,</span> <span class="s1">&#39;60&#39;</span><span class="p">,</span>
</span><span id="__span-5-24">        <span class="s1">&#39;-Tuning&#39;</span><span class="p">,</span> <span class="s1">&#39;123bde&#39;</span>
</span><span id="__span-5-25">    <span class="p">]</span>
</span><span id="__span-5-26">
</span><span id="__span-5-27">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-5-28">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running Nikto command: </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-29">        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="__span-5-30">                                   <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>  <span class="c1"># Using subprocess.PIPE</span>
</span><span id="__span-5-31">        <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="__span-5-32">        <span class="n">stdout_str</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  <span class="c1"># Decode bytes to string</span>
</span><span id="__span-5-33">        <span class="n">stderr_str</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="__span-5-34">
</span><span id="__span-5-35">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nikto Output:</span><span class="se">\n</span><span class="si">{</span><span class="n">stdout_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-36">        <span class="k">if</span> <span class="n">stderr_str</span><span class="p">:</span>
</span><span id="__span-5-37">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nikto Errors:</span><span class="se">\n</span><span class="si">{</span><span class="n">stderr_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-38">
</span><span id="__span-5-39">        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">html_report_filename</span><span class="p">):</span>
</span><span id="__span-5-40">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">html_report_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-5-41">                <span class="n">html_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="__span-5-42">
</span><span id="__span-5-43">            <span class="n">modified_html_content</span> <span class="o">=</span> <span class="n">remove_nikto_summary</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
</span><span id="__span-5-44">
</span><span id="__span-5-45">            <span class="n">pdf_filename</span> <span class="o">=</span> <span class="n">convert_html_to_pdf</span><span class="p">(</span><span class="n">modified_html_content</span><span class="p">,</span> <span class="n">pdf_report_filename</span><span class="p">,</span> <span class="n">COMPANY_LOGO_PATH</span><span class="p">,</span>
</span><span id="__span-5-46">                                               <span class="n">report_type</span><span class="o">=</span><span class="s2">&quot;Nikto Scan Report&quot;</span><span class="p">)</span>
</span><span id="__span-5-47">
</span><span id="__span-5-48">            <span class="k">if</span> <span class="n">pdf_filename</span><span class="p">:</span>
</span><span id="__span-5-49">                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">html_report_filename</span><span class="p">)</span>
</span><span id="__span-5-50">                <span class="k">return</span> <span class="n">pdf_filename</span>
</span><span id="__span-5-51">            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-5-52">                <span class="k">return</span> <span class="s2">&quot;Error: Failed to convert Nikto HTML report to PDF.&quot;</span>
</span><span id="__span-5-53">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-5-54">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: Nikto scan failed with return code </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">. See output for details.&quot;</span>
</span><span id="__span-5-55">
</span><span id="__span-5-56">    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="__span-5-57">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: Nikto executable not found at </span><span class="si">{</span><span class="n">NIKTO_EXECUTABLE</span><span class="si">}</span><span class="s2">. Please check your configuration.&quot;</span>
</span><span id="__span-5-58">    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
</span><span id="__span-5-59">        <span class="k">return</span> <span class="s2">&quot;Error: Nikto scan timed out.&quot;</span>
</span><span id="__span-5-60">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-5-61">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: An unexpected error occurred during Nikto scan: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="7-run_nikto_authenticated_scantarget_url-username-password-user_idnone">7. <code>run_nikto_authenticated_scan(target_url, username, password, user_id=None)</code></h3>
<ul>
<li>
<p><strong>Purpose:</strong> Executes an authenticated Nikto scan against a specified target URL.</p>
</li>
<li>
<p><strong>Functionality:</strong></p>
<ul>
<li>Similar to <code>run_nikto_scan()</code>, but includes username and password for authentication.</li>
<li>Uses the <code>-id</code> option to provide authentication credentials to Nikto.</li>
<li>Stores the results in the <code>authenticated_nikto_results</code> directory.</li>
<li>Returns the filename of the generated PDF report, or an error message if the scan or conversion fails.</li>
</ul>
</li>
<li>
<p><strong>Code Snippet:</strong></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-6-2"><span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
</span><span id="__span-6-3"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="__span-6-4"><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_app</span>
</span><span id="__span-6-5"><span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>  <span class="c1"># Import BeautifulSoup</span>
</span><span id="__span-6-6"><span class="kn">import</span><span class="w"> </span><span class="nn">pdfkit</span>
</span><span id="__span-6-7"><span class="kn">import</span><span class="w"> </span><span class="nn">fitz</span>
</span><span id="__span-6-8">
</span><span id="__span-6-9"><span class="k">def</span><span class="w"> </span><span class="nf">run_nikto_authenticated_scan</span><span class="p">(</span><span class="n">target_url</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-6-10">    <span class="n">NIKTO_EXECUTABLE</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NIKTO_EXECUTABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;/usr/bin/nikto&#39;</span><span class="p">)</span>  <span class="c1"># Adjust path as needed</span>
</span><span id="__span-6-11">    <span class="n">COMPANY_LOGO_PATH</span> <span class="o">=</span> <span class="s1">&#39;static/images/company_logo.PNG&#39;</span>  <span class="c1"># Change to your actual logo path - RELATIVE URL</span>
</span><span id="__span-6-12">    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
</span><span id="__span-6-13">    <span class="n">results_dir</span> <span class="o">=</span> <span class="n">get_authenticated_nikto_results_directory</span><span class="p">()</span>
</span><span id="__span-6-14">    <span class="n">html_report_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_nikto_auth_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
</span><span id="__span-6-15">    <span class="n">pdf_report_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_nikto_auth_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
</span><span id="__span-6-16">
</span><span id="__span-6-17">    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-6-18">        <span class="n">NIKTO_EXECUTABLE</span><span class="p">,</span>
</span><span id="__span-6-19">        <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="n">target_url</span><span class="p">,</span>
</span><span id="__span-6-20">        <span class="s1">&#39;-output&#39;</span><span class="p">,</span> <span class="n">html_report_filename</span><span class="p">,</span>
</span><span id="__span-6-21">        <span class="s1">&#39;-Format&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span>
</span><span id="__span-6-22">        <span class="s1">&#39;-id&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># Use -id with username:password</span>
</span><span id="__span-6-23">        <span class="s1">&#39;-timeout&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span>
</span><span id="__span-6-24">        <span class="s1">&#39;-maxtime&#39;</span><span class="p">,</span> <span class="s1">&#39;60&#39;</span><span class="p">,</span>
</span><span id="__span-6-25">        <span class="s1">&#39;-Tuning&#39;</span><span class="p">,</span> <span class="s1">&#39;123bde&#39;</span>
</span><span id="__span-6-26">    <span class="p">]</span>
</span><span id="__span-6-27">
</span><span id="__span-6-28">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-6-29">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running authenticated Nikto command: </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-6-30">        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="__span-6-31">                                   <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>  <span class="c1"># Using subprocess.PIPE</span>
</span><span id="__span-6-32">        <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="__span-6-33">        <span class="n">stdout_str</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  <span class="c1"># Decode bytes to string</span>
</span><span id="__span-6-34">        <span class="n">stderr_str</span> <span class="o">=</span> <span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="__span-6-35">
</span><span id="__span-6-36">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nikto Output:</span><span class="se">\n</span><span class="si">{</span><span class="n">stdout_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-6-37">        <span class="k">if</span> <span class="n">stderr_str</span><span class="p">:</span>
</span><span id="__span-6-38">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nikto Errors:</span><span class="se">\n</span><span class="si">{</span><span class="n">stderr_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-6-39">
</span><span id="__span-6-40">        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">html_report_filename</span><span class="p">):</span>
</span><span id="__span-6-41">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">html_report_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-6-42">                <span class="n">html_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="__span-6-43">
</span><span id="__span-6-44">            <span class="n">modified_html_content</span> <span class="o">=</span> <span class="n">remove_nikto_summary</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
</span><span id="__span-6-45">
</span><span id="__span-6-46">            <span class="n">pdf_filename</span> <span class="o">=</span> <span class="n">convert_html_to_pdf</span><span class="p">(</span><span class="n">modified_html_content</span><span class="p">,</span> <span class="n">pdf_report_filename</span><span class="p">,</span> <span class="n">COMPANY_LOGO_PATH</span><span class="p">,</span>
</span><span id="__span-6-47">                                               <span class="n">report_type</span><span class="o">=</span><span class="s2">&quot;Authenticated Nikto Scan Report&quot;</span><span class="p">)</span>
</span><span id="__span-6-48">
</span><span id="__span-6-49">            <span class="k">if</span> <span class="n">pdf_filename</span><span class="p">:</span>
</span><span id="__span-6-50">                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">html_report_filename</span><span class="p">)</span>
</span><span id="__span-6-51">                <span class="k">return</span> <span class="n">pdf_filename</span>
</span><span id="__span-6-52">            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-6-53">                <span class="k">return</span> <span class="s2">&quot;Error: Failed to convert authenticated Nikto HTML report to PDF.&quot;</span>
</span><span id="__span-6-54">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-6-55">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: Authenticated Nikto scan failed with return code </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">. See output for details.&quot;</span>
</span><span id="__span-6-56">
</span><span id="__span-6-57">    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="__span-6-58">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: Nikto executable not found at </span><span class="si">{</span><span class="n">NIKTO_EXECUTABLE</span><span class="si">}</span><span class="s2">. Please check your configuration.&quot;</span>
</span><span id="__span-6-59">    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
</span><span id="__span-6-60">        <span class="k">return</span> <span class="s2">&quot;Error: Authenticated Nikto scan timed out.&quot;</span>
</span><span id="__span-6-61">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-6-62">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: An unexpected error occurred during authenticated Nikto scan: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h2 id="dependencies">Dependencies</h2>
<ul>
<li><strong>Nikto:</strong> A web vulnerability scanner. Must be installed and in the system's PATH.</li>
<li><strong>Python Libraries:</strong><ul>
<li><code>subprocess</code>: For running external commands (Nikto).</li>
<li><code>os</code>: For file system operations.</li>
<li><code>datetime</code>: For generating unique report filenames.</li>
<li><code>flask</code>: For accessing the application's root path and configuration.</li>
<li><code>pdfkit</code>: For converting HTML to PDF (<code>pip install pdfkit</code>). Requires <code>wkhtmltopdf</code> to be installed.</li>
<li><code>BeautifulSoup4</code>: For parsing and manipulating HTML content (<code>pip install beautifulsoup4</code>).</li>
<li><code>PyMuPDF (fitz)</code>: For adding the company logo and title to the PDF (<code>pip install pymupdf</code>).</li>
</ul>
</li>
<li><strong>wkhtmltopdf:</strong> A command-line tool required by <code>pdfkit</code> to convert HTML to PDF. It needs to be installed separately. Follow the instructions at <a href="https://wkhtmltopdf.org/downloads.html">https://wkhtmltopdf.org/downloads.html</a> for your operating system.</li>
</ul>
<h2 id="configuration">Configuration</h2>
<ul>
<li><strong><code>NIKTO_EXECUTABLE</code>:</strong> A configuration setting in the Flask application that specifies the path to the Nikto executable. If not set, it defaults to <code>/usr/bin/nikto</code>. This is accessed via <code>current_app.config.get('NIKTO_EXECUTABLE', '/usr/bin/nikto')</code>.</li>
<li><strong><code>WKHTMLTOPDF_EXECUTABLE</code>:</strong> A configuration setting in the Flask application that specifies the path to the <code>wkhtmltopdf</code> executable. If not set, it defaults to <code>/usr/local/bin/wkhtmltopdf</code>. This is accessed via <code>current_app.config.get('WKHTMLTOPDF_EXECUTABLE', '/usr/local/bin/wkhtmltopdf')</code>.</li>
<li><strong><code>COMPANY_LOGO_PATH</code>:</strong> Specifies the relative path to the company logo image within the Flask application's static files directory (e.g., <code>'static/images/company_logo.PNG'</code>).</li>
</ul>
<h2 id="error-handling">Error Handling</h2>
<p>The script includes error handling in the following areas:</p>
<ul>
<li>Nikto execution (handling <code>FileNotFoundError</code>, <code>subprocess.TimeoutExpired</code>, and general exceptions).</li>
<li>HTML report processing.</li>
<li>PDF conversion (both <code>pdfkit</code> and <code>PyMuPDF</code>).</li>
<li>Missing dependencies (e.g., Nikto or <code>wkhtmltopdf</code> not installed).</li>
</ul>
<p>Errors are printed to the console and returned as error messages by the functions.</p>
<h2 id="security-considerations">Security Considerations</h2>
<ul>
<li><strong>Authentication Credentials:</strong> The <code>run_nikto_authenticated_scan()</code> function handles sensitive authentication credentials. It's critical to:<ul>
<li>Store the credentials securely before passing them to the script.</li>
<li>Avoid logging the credentials in plaintext.</li>
</ul>
</li>
<li><strong>Input Validation:</strong> The target URL should be validated to prevent command injection vulnerabilities.</li>
<li><strong>Nikto Execution:</strong> Nikto scans can be intrusive and may be detected by intrusion detection systems (IDS). Ensure you have permission to scan the target.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>